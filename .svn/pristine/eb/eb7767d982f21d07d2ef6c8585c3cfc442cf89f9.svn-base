/**
 *  自定义控件书写模板
 */
(function (KDApi, $) {
    // 构造函数，变量名随意，与最后一句代码的KDApi.register的第二个参数一致即可
    function HelloWorld(model) {
        this._setModel(model)
    }

    // 原型中封装生命周期函数，固定格式
    HelloWorld.prototype = {
        _setModel: function (model) {
            this.model = model
        },
        init: function (props) {
            // TO DO
            initFunc(this.model, props)
        },
        update: function (props) {
            // TO DO
        },
        destoryed: function () {
            // TO DO
        }
    }

    var initEvent = function (model, props) {
        //内置了jquery对象，可直接使用$
        $('#save', model.dom).click(function () {
            // model.invoke，用于给后端发送请求，第一个参数是事件名，可自定义；第二个参数是发送给后端的数据，可以是任意类型
            var projectnum =  $("#projectnum").text();
            var kjyfzc = $("#kjyfzc").val();
            var heshfx = $("#heshfx").val();
            var dfjdcgcb = $("#dfjdcgcb").val();
            var hlkzxcfyqk = $("#hlkzxcfyqk").val();
            var cktsgzwcqk = $("#cktsgzwcqk").val();
            var gzcg = $("#gzcg").val();
            var values = [];

            var yjbl = $(".yjbl").each(function (index,e) {
                var idName= $(e).attr('id');
                var value = $(e).val();
                values.push({"id":idName,"value":value})
            });

            var params = {
                projectnum:projectnum,
                kjyfzc:kjyfzc,
                heshfx:heshfx,
                dfjdcgcb:dfjdcgcb,
                hlkzxcfyqk:hlkzxcfyqk,
                cktsgzwcqk:cktsgzwcqk,
                gzcg:gzcg,
                values:values
            }

            model.invoke('click', params)
        })
    }

    // Other Code
    var initFunc = function (model, props) {

        KDApi.loadFile('./css/table.css', model, function() {

            var LOD_kjyfzc = props.data && props.data.LOD_kjyfzc || ''
            var LOD_gzcg = props.data && props.data.LOD_gzcg || ''
            var LOD_hlkzxcfyqk = props.data && props.data.LOD_hlkzxcfyqk || ''
            var LOD_cktsgzwcqk = props.data && props.data.LOD_cktsgzwcqk || ''
            var LOD_heshfx = props.data && props.data.LOD_heshfx || ''
            var LOD_dfjdcgcb = props.data && props.data.LOD_dfjdcgcb || ''
            var LOD_projectnum = props.data && props.data.LOD_projectnum || ''
            var LOD_values = props.data && props.data.LOD_values || ''

            var ECONS = props.data && props.data.ECONS || ''
            var PCONS = props.data && props.data.PCONS || ''

            var SUM_CURR_ECONS = props.data && props.data.SUM_CURR_ECONS || ''

            var ECONS_SUM = props.data && props.data.ECONS_SUM || ''
            var PCONS_SUM = props.data && props.data.PCONS_SUM || ''

            var PROJECT_NAME = props.data && props.data.PROJECT_NAME || ''
            var PROJECT_CODE = props.data && props.data.PROJECT_CODE || ''

            var CONTRACT_INCOME = props.data && props.data.CONTRACT_INCOME || ''
            var CONTRACT_INTHEED = props.data && props.data.CONTRACT_INTHEED || ''
            var ACCOUNT_INTHEED = props.data && props.data.ACCOUNT_INTHEED || ''
            var CONTRACT_DIRECT_COST = props.data && props.data.CONTRACT_DIRECT_COST || ''
            var CONTRACT_INDIRECT_COST = props.data && props.data.CONTRACT_INDIRECT_COST || ''
            var PROJECT_FUNDS = props.data && props.data.PROJECT_FUNDS || ''
            var PROFITS = props.data && props.data.PROFITS || ''
            var PROFITS_MARGIN = props.data && props.data.PROFITS_MARGIN || ''

            var JJ_xybx = props.data && props.data.JJ_xybx || ''
            var JJ_ysbx = props.data && props.data.JJ_ysbx || ''
            var JJ_yyf = props.data && props.data.JJ_yyf || ''
            var JJ_nlyzf = props.data && props.data.JJ_nlyzf || ''
            var JJ_bzf = props.data && props.data.JJ_bzf || ''
            var JJ_ccbgf = props.data && props.data.JJ_ccbgf || ''
            var JJ_jpglf = props.data && props.data.JJ_jpglf || ''
            var JJ_cgf = props.data && props.data.JJ_cgf || ''
            var JJ_jtf = props.data && props.data.JJ_jtf || ''
            var JJ_lpf = props.data && props.data.JJ_lpf || ''
            var JJ_ywzdf = props.data && props.data.JJ_ywzdf || ''
            var JJ_hyf = props.data && props.data.JJ_hyf || ''
            var JJ_clf = props.data && props.data.JJ_clf || ''
            var JJ_bhf = props.data && props.data.JJ_bhf || ''
            var JJ_pxf = props.data && props.data.JJ_pxf || ''
            var JJ_yj = props.data && props.data.JJ_yj || ''
            var JJ_yhsxf = props.data && props.data.JJ_yhsxf || ''
            var JJ_hdsy = props.data && props.data.JJ_hdsy || ''
            var JJ_ygcgbx = props.data && props.data.JJ_ygcgbx || ''
            var JJ_ypf = props.data && props.data.JJ_ypf || ''
            var JJ_pxf1 = props.data && props.data.JJ_pxf1 || ''
            var JJ_lwf = props.data && props.data.JJ_lwf || ''
            var JJ_hsscjrjzzf = props.data && props.data.JJ_hsscjrjzzf || ''
            var JJ_qt = props.data && props.data.JJ_qt || ''
            var JJ_xcxmjf = props.data && props.data.JJ_xcxmjf || ''
            var JJ_SUM = props.data && props.data.JJ_SUM || ''
            var JJ_tsje = props.data && props.data.JJ_tsje || ''

            var YG_zjcb = props.data && props.data.YG_zjcb || ''
            var YG_yj = props.data && props.data.YG_yj || ''
            var YG_xcf = props.data && props.data.YG_xcf || ''
            var YG_qtfy = props.data && props.data.YG_qtfy || ''
            var YG_hyf = props.data && props.data.YG_hyf || ''
            var YG_ckbxf = props.data && props.data.YG_ckbxf || ''

            var HT_HTYSH = props.data && props.data.HT_HTYSH || ''
            var HT_HTYSH_BL = props.data && props.data.HT_HTYSH_BL || ''
            var HT_HSQYSH = props.data && props.data.HT_HSQYSH || ''
            var HT_HSQYSH_BL = props.data && props.data.HT_HSQYSH_BL || ''

            PCONS = "<table frame=void class=\"default-table\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                "                <tr>\n" +
                "                    <th colspan=\"2\">直接成本</th>\n" +
                "                </tr>\n" +
                "                <tr>\n" +
                "                    <td></td>\n" +
                "                    <td>对内合同金额</td>\n" +
                "                </tr>\n" +
                "                " + PCONS + "" +
                "                <tr>\n" +
                "                    <td>合计</td>\n" +
                "                    <td>" + PCONS_SUM + "</td>\n" +
                "                </tr>\n" +
                "            </table>"

            ECONS = "<table frame=void class=\"default-table\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                "                <tr>\n" +
                "                    <th colspan=5>合同收入</th>\n" +
                "                </tr>\n" +
                "                <tr>\n" +
                "                    <td>退税金额</td>\n" +
                "                    <td colspan=\"4\">" + JJ_tsje + "</td>\n" +
                "                </tr>\n" +
                "                <tr>\n" +
                "                    <td>合同号</td>\n" +
                "                    <td>对外合同金额</td>\n" +
                "                    <td>对外合同币种</td>\n" +
                "                    <td>测算汇率</td>\n" +
                "                    <td>佣金比例</td>\n" +
                "                </tr>\n" +
                "                " + ECONS + "" +
                "            </table>"

            SUM_CURR_ECONS = "<table frame=void class=\"default-table\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                "                " + SUM_CURR_ECONS + "" +
                "            </table>"

            // 通过路径去获取html字符串，第一个参数是模版文件路径，第二个参数是model，第三个参数是HTML模板中变量的值
            KDApi.getTemplateStringByFilePath('./html/highaward.art', model, {


                // ECONS: ECONS,
                // PCONS: PCONS,


                ECONS_SUM: ECONS_SUM,
                PCONS_SUM: PCONS_SUM,

                PROJECT_NAME: PROJECT_NAME,
                PROJECT_CODE: PROJECT_CODE,

                CONTRACT_INCOME:CONTRACT_INCOME,
                CONTRACT_INTHEED:CONTRACT_INTHEED,
                ACCOUNT_INTHEED:ACCOUNT_INTHEED,
                CONTRACT_DIRECT_COST:CONTRACT_DIRECT_COST,
                CONTRACT_INDIRECT_COST:CONTRACT_INDIRECT_COST,
                PROJECT_FUNDS:PROJECT_FUNDS,
                PROFITS:PROFITS,
                PROFITS_MARGIN:PROFITS_MARGIN,

                JJ_xybx: JJ_xybx,//
                JJ_ysbx: JJ_ysbx,
                JJ_yyf: JJ_yyf,
                JJ_nlyzf: JJ_nlyzf,
                JJ_bzf: JJ_bzf,
                JJ_ccbgf: JJ_ccbgf,
                JJ_jpglf: JJ_jpglf,
                JJ_cgf: JJ_cgf,
                JJ_jtf: JJ_jtf,
                JJ_lpf: JJ_lpf,
                JJ_ywzdf: JJ_ywzdf,
                JJ_hyf: JJ_hyf,
                JJ_clf: JJ_clf,
                JJ_bhf: JJ_bhf,
                JJ_pxf: JJ_pxf,
                JJ_yj: JJ_yj,
                JJ_yhsxf: JJ_yhsxf,
                JJ_hdsy: JJ_hdsy,
                JJ_ygcgbx: JJ_ygcgbx,
                JJ_ypf: JJ_ypf,
                JJ_pxf1: JJ_pxf1,
                JJ_lwf: JJ_lwf,
                JJ_hsscjrjzzf: JJ_hsscjrjzzf,
                JJ_qt: JJ_qt,
                JJ_xcxmjf:JJ_xcxmjf,
                JJ_SUM: JJ_SUM,
                JJ_tsje:JJ_tsje,

                YG_zjcb:YG_zjcb,
                YG_yj:YG_yj,
                YG_xcf:YG_xcf,
                YG_qtfy:YG_qtfy,
                YG_hyf:YG_hyf,
                YG_ckbxf:YG_ckbxf,

                HT_HTYSH:HT_HTYSH,
                HT_HTYSH_BL:HT_HTYSH_BL,
                HT_HSQYSH:HT_HSQYSH,
                HT_HSQYSH_BL:HT_HSQYSH_BL,
            }).then(function (result) {
                model.dom.innerHTML = result

                $('#ECONS').html(ECONS + SUM_CURR_ECONS);
                $('#PCONS').html(PCONS);

                $("#projectnum").val(LOD_projectnum);
                $("#kjyfzc").val(LOD_kjyfzc);
                $("#heshfx").val(LOD_heshfx);
                $("#dfjdcgcb").val(LOD_dfjdcgcb);
                $("#hlkzxcfyqk").val(LOD_hlkzxcfyqk);
                $("#cktsgzwcqk").val(LOD_cktsgzwcqk);
                $("#gzcg").val(LOD_gzcg);

                var LOD_values_ts = $.parseJSON(LOD_values)
                for(var LOD_values_t in LOD_values_ts){
                    var id_v = LOD_values_ts[LOD_values_t].id
                    var value_v = LOD_values_ts[LOD_values_t].value

                    $("#"+id_v).val(value_v)
                }

                initEvent(model, props)
            })
        })
    }

    // 你只需知道第一个参数是你接下来要新增控件方案时填的方案id，第二个参数是上面声明的构造函数
    KDApi.register('highaward1', HelloWorld)
})(window.KDApi, jQuery) // 这里的jQuery不是必须要传进去的，可移除，要用到的时候才传，PC端系统默认会有jQuery对象，版本是1.12.4